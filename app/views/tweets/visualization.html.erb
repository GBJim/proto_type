<script src="http://openlayers.org/en/v3.0.0/build/ol.js" type="text/javascript"></script>


<%#=link_to "hello",visualization_tweets_path(:box => [ -94.4331050844363, 31.087210883621594, -63.3198238344363, 45.917855232368424 ])%>

<%=form_tag visualization_tweets_path, :method => :get do%>
<%=label_tag 'body'%>
<%=text_field_tag :q, params[:q]%>
<%=label_tag 'Area'%>
<%=text_field_tag :search, params[:search]%>
<%=submit_tag "search Near", :name => nil%>
<%end%>

<h2><%=@count%> Tweets</h2>
<div class = "row">
	<div class = "col-md-3">
<%=render :partial =>"face"%>
</div>
<div class = "col-md-3">
<%=render :partial =>"face_v2"%>
</div>
<div id="face-one" width = "25%" height = "25%"></div>
</div>
<div id = "pie-chart"></div>
<div id = "line-chart"></div>
<div id="map" class="map" style ="max-width: 90%"></div>

<table class = "table table-hover">
<%=render @show_tweets%>
</table>


 <script type="text/javascript">
    var source = new ol.source.GeoJSON({url : document.URL+ "&format=json" });
 

      var map = new ol.Map({
        target: 'map',
        layers: [
         new ol.layer.Tile({
    title: "Global Imagery",
    source: new ol.source.TileWMS({
      url: 'http://maps.opengeo.org/geowebcache/service/wms',
      params: {LAYERS: 'openstreetmap', VERSION: '1.1.1'}
    })
  }),
         new ol.layer.Vector({
            title: 'Earthquakes',
            source: source,
            style: new ol.style.Style({
              image: new ol.style.Circle({
                radius: 5,
                fill: new ol.style.Fill({
                  color: '#0000FF'
                }),
                stroke: new ol.style.Stroke({
                  color: '#000000'
                })
              })
            })
          })
        ],

        view: new ol.View({
          projection: 'EPSG:4326',
          center: [0,0],
          zoom: 0,
          maxResolution: 0.703125
        })
      });

  var dragBox = new ol.interaction.DragBox({
  condition: ol.events.condition.shiftKeyOnly,
  style: new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: [0, 0, 255, 1]
    })
  })
});
map.addInteraction(dragBox);




dragBox.on('boxend', function(e) {
  // features that intersect the box are added to the collection of
  // selected features, and their names are displayed in the "info"
  // div


  var extent = dragBox.getGeometry().getExtent();

  window.location.href = Routes.visualization_tweets_path({box: extent})

});





</script>

